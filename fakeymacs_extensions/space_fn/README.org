#+STARTUP: showall indent

* Fakeymacs extension

** ■ SpaceFN を実現する設定を行う

SpaceFN を実現する設定を行う拡張機能です。

*** コンフィグレーションパラメータ

|----------------------------------+----------------------------------------------------------------------------------------------------|
| Configuration parameter          | Description                                                                                        |
|----------------------------------+----------------------------------------------------------------------------------------------------|
| fc.space_fn_key                  | SpaceFN 用のモディファイアキーを指定する                                                           |
| fc.space_fn_window_keymap_list   | SpaceFN を適用するキーマップを指定する                                                             |
| fc.space_fn_use_oneshot_function | SpaceFN 用のモディファイアキーの単押しで、元のキーの機能を利用するかどうかを指定する               |
|----------------------------------+----------------------------------------------------------------------------------------------------|

*** サンプル設定ファイル（_config_personal-1.py、_config_personal-2.py）で設定しているキーバインド

サンプル設定ファイルを有効にするには、サンプル設定ファイルを config_personal.py に複写し、Keyhac を
リロードする必要があります。

「U0」は fc.space_fn_key 変数に設定した SpaceFN 用のモディファイアキーを指しています。

このサンプル設定は、次のサイトの設定を参考としています。
（Esc を割り当てている e キーの設定のみ、除外しています。これは、keymap_emacs キーマップで、Esc を
マルチストロークキーとして設定している場合があり、その際の SpaceFN キーの設定が複雑になるためです。）

- https://geekhack.org/index.php?topic=51069.0

**** ● SpaceFN 主要キーの設定

|-------------+-----------------+-------------|
| Keybind     | replacement key | Description |
|-------------+-----------------+-------------|
| U0-<m>-j    | <m>-Left        |             |
| U0-<m>-l    | <m>-Right       |             |
| U0-<m>-i    | <m>-Up          |             |
| U0-<m>-k    | <m>-Down        |             |
| U0-<m>-u    | <m>-Home        |             |
| U0-<m>-o    | <m>-End         |             |
| U0-<m>-h    | <m>-PageUp      |             |
| U0-<m>-n    | <m>-PageDown    |             |
| U0-<m>-Esc  | <m>-`           |             |
| U0-<m>-Back | <m>-Delete      |             |
| U0-<m>-p    | <m>-PrintScreen |             |
| U0-<m>-[    | <m>-ScrollLock  |             |
| U0-<m>-]    | <m>-Pause       |             |
| U0-<m>-\    | <m>-Insert      |             |
| U0-<m>-b    | <m>-Space       |             |
| U0-<m>-m    | <m>-`           |             |
| U0-<m>-,    | <m>-S-`         |             |
| U0-<m>-/    | <m>-Apps        |             |
|-------------+-----------------+-------------|

- _config_personal-1.py のサンプル設定では、<m> は <空>、<A->、<C->、<S-> の全ての組み合わせパターン
- _config_personal-2.py のサンプル設定では、<m> は <空> か <S-> のどちらかのパターン

**** ● ファンクションキーの設定

|-----------------------------+-----------------+-------------|
| Keybind                     | replacement key | Description |
|-----------------------------+-----------------+-------------|
| U0-<m>-1                    | <m>-F1          |             |
| U0-<m>-2                    | <m>-F2          |             |
| U0-<m>-3                    | <m>-F3          |             |
| U0-<m>-4                    | <m>-F4          |             |
| U0-<m>-5                    | <m>-F5          |             |
| U0-<m>-6                    | <m>-F6          |             |
| U0-<m>-7                    | <m>-F7          |             |
| U0-<m>-8                    | <m>-F8          |             |
| U0-<m>-9                    | <m>-F9          |             |
| U0-<m>-0                    | <m>-F10         |             |
| U0-<m>-<上記の右隣のキー>   | <m>-F11         |             |
| U0-<m>-<上記の右隣のキー>   | <m>-F12         |             |
| U0-<m>-S-1                  | <m>-F13         |             |
| U0-<m>-S-2                  | <m>-F14         |             |
| U0-<m>-S-3                  | <m>-F15         |             |
| U0-<m>-S-4                  | <m>-F16         |             |
| U0-<m>-S-5                  | <m>-F17         |             |
| U0-<m>-S-6                  | <m>-F18         |             |
| U0-<m>-S-7                  | <m>-F19         |             |
| U0-<m>-S-8                  | <m>-F20         |             |
| U0-<m>-S-9                  | <m>-F21         |             |
| U0-<m>-S-0                  | <m>-F22         |             |
| U0-<m>-S-<上記の右隣のキー> | <m>-F23         |             |
| U0-<m>-S-<上記の右隣のキー> | <m>-F24         |             |
|-----------------------------+-----------------+-------------|

- _config_personal-1.py のサンプル設定では、<m> は <空>、<A->、<C-> の全ての組み合わせパターン
- _config_personal-2.py のサンプル設定では、<m> は <空> のパターンのみ

*** 留意事項

● 初期の設定では、SpaceFN を実現するベースの設定のみを行っています。SpaceFN のキー設定を
行う際は、_config_personal_1.py もしくは _config_personal_2.py を config_personal.py
に複写し、そのファイルの中で行うようにしてください。

● _config_personal_1.py は、Ctrl キーや Alt キーとの組み合わせも含め、できるだけ完全な
キーの複製を行う設定サンプルです。
_config_personal_2.py は、Ctrl キーや Alt キーとの組み合わせは行わない、キー単体と Shift
キーの組み合わせのみのキーの複製を行う設定サンプルです。
SpaceFN は、設定を行っていない SpaceFN のキーを入力すると、SpaceFN 用のモディファイア
キーを除いたキーを発行する機能を持っています。そして 本拡張機能の SpaceFN の場合は、
Emacs キーバインドの機能ではなく、Windows 本来のキーの機能が実行される仕様としています。
この機能を活用することにより、SpaceFN 用のモディファイアキーを押してから Ctrl+x や Ctrl+c
などのキーを入力すると、Windows 本来のキーの機能の「カット」や「コピー」などを利用する
ことができます。
HHKB US キーボードのように、Ctrl キーが一つしか持てない（CapsLock キーに RCtrl キーを
割当てられない）キーボードを使って Fakeymacs の Emacs キーバインドを利用する場合、
Windows 本来のキーの機能を利用するために Ctrl+q を前置する方法がありますが、本説明の
機能を用いることで、同等の機能を実現することができます。
_config_personal_2.py は、この機能を利用する場合の設定サンプルとしてご利用ください。

● SpaceFN 用のモディファイアキーと組み合わせ可能なモディファイアキーは、Ctrl キー、
Alt キー、Shift キーとします（Win キーは除きます）。
これは、Keyhac に登録可能なキーの上限を超えてエラーが発生するようになったことによる
制限事項となります。

● 本拡張機能の SpaceFN は、初期値として keymap_emacs と keymap_im のキーマップのみで
動作するようにしています。
fc.space_fn_window_keymap_list 変数の指定ににより、SpaceFN を適用するキーマップを
変更することができます。

● 本拡張機能の SpaceFN は、key rollover の対策を行っており、SpaceFN でよく言われる
1KRO の問題を極力回避する実装をしています。

● 本拡張機能の SpaceFN を利用する場合は、必ず SpaceFN 用のモディファイアキー（初期値は
Space）から入力するようにしてください。本拡張機能の SpaceFN は、Shift や Ctrl などその他の
モディファイアキーと組み合わせて利用することもできますが、その他のモディファイアキーを
最初に入力した場合には、SpaceFN 用のモディファイアキーを入力した時点でキーの入力が
確定する仕様としています。（これは、Ctrl+Space や Shift+Space を遅延なく入力できるように
する対策です。）

● 本拡張機能の特徴については、次の issue にも記載しています。

- https://github.com/smzht/fakeymacs/issues/30

